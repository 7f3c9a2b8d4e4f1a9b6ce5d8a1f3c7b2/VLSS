# Unstake Ticket Unwrap Time

## Summary
No summary provided.

## Details
## UnstakeTicket Overview

UnstakeTicket is generated each time a user initiates an unstake request, which may be unwrapped at any time. The sole exception is when the total supply of unstake tickets surpasses the active stake of the protocol, in which case the ticket will be locked during the current epoch.

## Function: mint_ticket_non_entry

In `native_pool::mint_ticket_non_entry`, several checks are conducted as part of the ticket preparation process:

```rust
public fun mint_ticket_non_entry(self: &mut NativePool, metadata: &mut Metadata<CERT>, cert: Coin<CERT>, ctx: &mut TxContext): UnstakeTicket {
    // ...
    // charge commission for big unstakes
    let total_staked = get_total_staked(self);
    let max_supply_for_2epochs = unstake_ticket::get_max_supply_for_2epochs(&self.ticket_metadata, ctx) + unstake_amount;

    let unstake_fee = 0;
    if (max_supply_for_2epochs > math::mul_div(total_staked, self.unstake_fee_threshold, MAX_PERCENT)) {
        // time to charge some fee
        unstake_fee = calculate_unstake_fee(self, unstake_amount);
    };
    
    // if not enough active stakes to do instant unstake
    let tickets_supply_after_mint = unstake_ticket::get_total_supply(&self.ticket_metadata) + unstake_amount;
    let total_active_stake = get_total_active_stake(self, ctx);
    let unlocked_in_epoch = tx_context::epoch(ctx);
    
    if (tickets_supply_after_mint > total_active_stake) {
        // we can't proceed unstake in this epoch
        unlocked_in_epoch = unlocked_in_epoch + 1;
    };
    // ...
}
```

However, it is important to note that the outcome of these checks may vary if `UnstakeTicket` is burned at a point later than the next epoch.

## Remediation

Contemplate a potential reimplementation of `mint_ticket_non_entry` or relocate the checks to `burn_ticket_non_entry`.

## Volo Audit 05 | General Findings

### Patch

The Volo teamâ€™s response clarifies that the `UnstakeTicket` essentially represents a promise that allows users to request unstaking at any epoch.
