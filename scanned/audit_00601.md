# Denial Of Service Via Teleport Hash Tracking

## Summary
The teleport::teleport_from_flow function allows teleport administrators to create tokens for a specific account by providing a flow_addr and flow_tx_hash. However, the function uses a SimpleMap data structure which results in O(n) time complexity, making it inefficient and impractical for use. To fix this, it is recommended to replace the SimpleMap with a different data structure like a table to prevent potential denial of service attacks. This issue has been fixed in the latest updates by replacing the SimpleMap with a new resource called Unlocked.

## Details
## Teleport Function Overview

The function `teleport::teleport_from_flow` enables teleport administrators to create tokens for a particular account by requesting a `flow_addr` and `flow_tx_hash`. This ensures that the transaction hash has not been unlocked and is added to the unlocked `SimpleMap`.

## Code Snippet

```rust
simple_map::add<vector<u8>, bool>(&mut administrator.unlocked, flow_tx_hash, true);
```

However, the `SimpleMap::add` function checks for the existence of the provided key in the map by executing a linear search, which results in O(n) time complexity. As a result, each invocation of the `teleport_from_flow` function will require more gas, eventually reaching the Aptos gas limit, rendering it impractical for use.

## Code Snippet

```rust
fun find<Key: store, Value: store>(
    map: &SimpleMap<Key, Value>,
    key: &Key,
): option::Option<u64> {
    let leng = vector::length(&map.data);
    let i = 0;
    while (i < leng) {
        let element = vector::borrow(&map.data, i);
        if (&element.key == key) {
            return option::some(i);
        };
        i = i + 1;
    };
    option::none<u64>()
}
```

## Remediation

We recommend replacing the usage of `SimpleMap` with a different data structure, such as a table, to prevent potential denial of service attacks.

---

## Patch

Fixed in commits `1a57717` and `7f85115` by replacing the use of a `SimpleMap` with a new resource `Unlocked`.

## Code Snippet

```rust
struct Unlocked {
    record: Table<vector<u8>, bool>,
}
```

The `MODULE_OWNER` is assigned this resource during module initialization using the `create_unlocked_table` function.

---

Â© 2023 Otter Audits LLC. All Rights Reserved.  
DRAFT  
Blocto Audit 04 | Vulnerabilities
