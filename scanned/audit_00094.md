# M-37: Inconsistent Pause Mechanism Allows Withdrawals During Emergency Pause

## Summary
The bug report is about a potential security issue in the `withdraw_impl` function of the `gateway.move` code. This function does not have a pause mechanism, unlike the deposit functionality, which could allow withdrawals to continue even when the system should be paused. This creates an inconsistency in the security controls and could be exploited by attackers. The root cause of this issue is that the `withdraw_impl` function does not have a pause flag, while the deposit functions do. This could be exploited by attackers with WithdrawCap to withdraw funds from the gateway vaults while legitimate deposits are blocked. The impact of this bug is that withdrawals can continue even when the system should be completely paused, and it creates confusion and potential vulnerabilities due to different security controls for deposits and withdrawals. To mitigate this issue, a `paused` variable should be added to the Gateway struct and used to check both deposits and withdrawals. This will ensure that withdrawals are properly paused when the system is in a paused state.

## Details
Source: https://github.com/sherlock-audit/2025-04-zetachain-cross-chain-judging/issues/410 

## Found by 
0xC2939291, Al-Qa-qa, Alpha, Goran, Laksmana, ifeco445, pks\_, zanderbyte

### Summary

The `withdraw_impl` function in `gateway.move` lacks a pause mechanism, unlike the deposit functionality which has proper pause checks. This creates an inconsistency in the security controls and could allow withdrawals to continue even when the system should be paused.

### Root Cause

The `withdraw_impl` function does not have a pause flag, while the deposit functions (`check_receiver_and_deposit_to_vault`) have the flag. This creates a security gap where withdrawals can continue even when deposits are paused.

https://github.com/sherlock-audit/2025-04-zetachain-cross-chain/blob/main/protocol-contracts-sui/sources/gateway.move#L271-L282

### Internal Pre-conditions

- The caller must have a valid WithdrawCap
- The coin type must be whitelisted
- The nonce must match the current gateway nonce


### External Pre-conditions

- The caller must have permission to call the function
- The system(gateway vault) must have sufficient balance for the withdrawal

### Attack Path

1. An attacker with WithdrawCap can continue to withdraw funds even when the system is in a paused state
2. This could be exploited during emergency situations when the system should be completely paused
3. The attacker could withdraw funds from gateway vaults while legitimate deposits are blocked

### Impact

1. Withdrawals can continue even when the system should be completely paused
2. Different security controls for deposits and withdrawals create confusion and potential vulnerabilities

### PoC

_No response_

### Mitigation

Add a `paused` variable to Gateway struct and use this check in both deposits and withdrawals.
```move
assert!(!gateway.paused, EPaused);
```
This will ensure that withdrawals are properly paused when the system is in a paused state.
