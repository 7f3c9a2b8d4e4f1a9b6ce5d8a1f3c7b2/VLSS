# Incorrect Function Call

## Summary
The report discusses a bug in a piece of code that is responsible for estimating the swap balance between two assets. Instead of using the correct function to retrieve the current balance of the asset being swapped, the code mistakenly calls a different function that only retrieves estimated amounts. This results in inaccurate estimates being made. The solution is to first store the balance of the asset being swapped before calling the function to retrieve estimated amounts. The bug has been fixed in a recent update.

## Details
## Estimation Issue in Swap Functionality

The function `estimate` should estimate the swap balance of one asset (T2) from another asset (T1). However, instead of utilizing the correct function to retrieve the current balance of the asset being swapped (T2), it mistakenly calls `get_estimate`, which retrieves the estimated amounts instead of the actual balances.

> _sources/squid/deepbook_v2.moverust

```rust
public fun estimate<T1, T2>(self: &mut SwapInfo, pool: &Pool<T1, T2>, clock: &Clock) {
    [...]
    if(has_base) {
        let (amount_left, output) = predict_base_for_quote(
            pool,
            self.coin_bag().get_estimate<T1>(),
            lot_size,
            clock,
        );
        self.coin_bag().store_estimate<T1>(amount_left);
        self.coin_bag().store_estimate<T2>(output);
    }
    [...]
}
```

Since `get_estimate` returns zero (assuming no estimate has been stored), the estimation process will be based on an incorrect or missing balance amount, resulting in inaccurate estimates.

## Remediation

Ensure to store the balance of the asset being swapped to `estimate` before calling `get_estimate`.

## Patch

Fixed in PR #58.

Â© 2024 Otter Audits LLC. All Rights Reserved. 7/18
