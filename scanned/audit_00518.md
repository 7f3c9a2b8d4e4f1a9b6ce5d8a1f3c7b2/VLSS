# Unrevokable Minter Capability

## Summary
No summary provided.

## Details
## Havencompass Admin MintCap Management

The Havencompass admin issues MintCaps to minters to allow minting of new GameKeys.

## Code Overview

### Issue MintCap Function

```rust
havencompass/sources/havencompass.move
pub fun issue_mint_cap(_cap: &mut AdminCap, ctx: &mut TxContext): MintCap {
    let mint_cap = MintCap {
        id: object::new(ctx)
    };
    mint_cap
}
```

Issued MintCaps may only be burnt with the full cooperation of MintCap owners.

### Burn MintCap Function

```rust
havencompass/sources/havencompass.move
pub fun burn_mintcap(mint_cap: MintCap) {
    let MintCap { id } = mint_cap;
    object::delete(id)
}
```

Thus, if a minter turns malicious due to cases such as wallet compromise, then admins would be unable to perform damage control by revoking mint permissions.

## Remediation

Add a max amount field for each MintCap to limit the amount of GameKey it is allowed to mint. This would allow the admin to limit potential damage without having to consistently monitor on-chain minting states.

### Code Changes

```diff
havencompass/sources/havencompass.move
+ const EMintLimitReached: u64 = 2;
struct MintCap has key, store {
    id: UID,
+   max_mint: u64, // max number of NFTs that can be minted.
}
- public fun issue_mint_cap(_cap: &mut AdminCap, ctx: &mut TxContext): MintCap {
+ public fun issue_mint_cap(
+   _cap: &mut AdminCap,
+   max_mint: u64,
    ctx: &mut TxContext
+ ): MintCap {
    let mint_cap = MintCap {
        id: object::new(ctx),
+       max_mint
    };
    mint_cap
}

public fun mint<T>(
-   _cap: &mut MintCap,
+   mint_cap: &mut MintCap,
    supply: &mut GameKeySupply<T>,
    name: String,
    description: String,
    url: String,
    ctx: &mut TxContext
): GameKey<T> {
+   // Continue only if the caller has not reached the maximum mint.
+   assert!(mint_cap.max_mint > 0, EMintLimitReached);
    // Check if the supply has reached its maximum.
    assert!(can_mint<T>(supply), ESupplyExhausted);
    ...
    // Increment the supply.
    supply.current = supply.current + 1;
+   // Decrease caller's max mint by 1.
+   mint_cap.max_mint = mint_cap.max_mint - 1;
    ...
}
```

## Patch

Resolved in commit **8931e51**.
