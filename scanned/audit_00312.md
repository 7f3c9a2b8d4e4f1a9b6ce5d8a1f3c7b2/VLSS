# Improper Reward Distribution

## Summary
No summary provided.

## Details
## Delegation Pool and Add Stake Fees

The `delegation_pool` transfers the `add_stake_fees` to the `NULL_SHAREHOLDER` and later returns them to the pool at the end of the epoch. This process occurs because the delegation pool does not distinguish between active and pending_active users, allowing both groups to receive rewards. To ensure active users get their rewards and pending_active users receive their `add_stake_fees` as rewards in the subsequent epoch, the system imposes `add_stake_fees` on users.

> _aptos-staker/source/staker.move
> 
> ```rust
> // calculate the delegation pool's "add stake fee" for this stake
> let add_stake_fee = amount - (active_after_stake - active_before_stake);
> // add the "add stake fee" amount to the staker's total amount of staking fees paid to this
> delegation pool for this epoch.
> let pools_mut = borrow_global_mut<DelegationPools>(RESOURCE_ACCOUNT);
> let pool_mut = smart_table::borrow_mut(&mut pools_mut.delegation_pools, delegation_pool);
> pool_mut.add_stake_fees = pool_mut.add_stake_fees + add_stake_fee;
> ```

In this protocol, `add_stake_fees`, which is distributed as rewards in the next epoch, is treated as stake within the same epoch, resulting in the minting of `TruAPT`. Consequently, users will receive extra rewards from others who are active in the subsequent epoch.

## Remediation

Avoid considering `add_stake_fees` as staked amount and only mint `truAPT` for the amount that is actually being staked (`active_after_stake - active_before_stake`).

## Patch

The development team acknowledges the issue and accepts the risk.

Â© 2024 Otter Audits LLC. All Rights Reserved. 5/12
