# Asymmetric Funding Debt Handling Between Long and Short Positions

## Summary
No summary provided.

## Details
**Update**
Marked as "Acknowledged" by the client. The client provided the following explanation:

> Although the handling of long and short positions differs, the underlying logic is correct. We do not plan to make modifications for the time being.

**File(s) affected:**`exchange.move`

**Description:** The protocol handles unpaid funding debt asymmetrically between long and short positions during ADL execution (flag=3). While long positions can accumulate unbounded debt by inflating `oi_open`, short positions have their debt capped at `oi_open` due to the unsigned integer type constraint.

**Long Positions** (exchange.move:1160-1162):

```
if (is_long) {
    // Debt deferred indefinitely by inflating oi_open
    position::set_oi_open(user_pos, oi_open + settlement_amount);
}
```

For longs, unpaid funding increases `oi_open`, which reduces future PnL and increases bankruptcy price. This effectively defers the debt to be paid when the position eventually closes.

**Short Positions** (exchange.move:1163-1175):

```
else {
    if (settlement_amount > oi_open) {
        // Debt exceeding oi_open is forgiven
        position::set_oi_open(user_pos, 0);
        emit(SettlementAmountNotPaidCompletelyEvent {
            amount: settlement_amount - oi_open,
        });
    } else {
        position::set_oi_open(user_pos, oi_open - settlement_amount);
    }
}
```

For shorts, `oi_open` (unsigned u128) cannot go negative. If funding debt exceeds `oi_open`, the excess is written off, meaning counterparty traders owed this funding would not receive it.

While this would negatively impact the protocol, the condition `settlement_amount > oi_open` is practically unreachable because positions are liquidated long before sufficient funding debt can accumulate. At the protocol's maximum 1% hourly funding rate, a position would need 100+ hours to accumulate debt exceeding `oi_open`, but margin depletion triggers liquidation within ~5 hours.

Nevertheless, the code asymmetry between long and short handling creates potential confusion.

**Recommendation:** While this code path is practically unreachable, if it were somehow triggered, the debt should not be written off. We recommend applying the same unbounded debt-tracking approach to shorts as used for longs (though this would require changing `oi_open` to a signed integer type, representing a significant architectural change).
