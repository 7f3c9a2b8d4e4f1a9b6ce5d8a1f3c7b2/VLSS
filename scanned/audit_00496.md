# RPC starkNet_addErc20Token - Should Ask for User Confirmation ✓ Fixed

## Summary
This bug report is about a RPC method (upserts ERC20 tokens) in the StarkNet-Snap, which allows a connected dapp to insert/change ERC20 token information without asking for user confirmation. This can lead to race conditions or other problems when multiple dapps are connected to the StarkNet-Snap. The bug was fixed by requesting user confirmation for adding new ERC20 Tokens, and additionally, disabling the loading frame when the user rejects the add ERC20 token request on the UI. The recommendation is to ask the user for confirmation when changing the snaps state.

## Details
#### Resolution



Fixed with [Consensys/starknet-snap@7231bb7fa4671283b2e7b4cbf5a519d56a57697a](https://github.com/Consensys/starknet-snap/tree/7231bb7fa4671283b2e7b4cbf5a519d56a57697a) by requesting user confirmation for adding new ERC20 Tokens. Additionally, the client provided the following statement:



> 
> 1. Adding confirm dialog with MM copyable field, it can ignore any markdown or tag block
> 2. Disable loading frame when user reject the add ec220 token request on UI
> 
> 
> 




#### Description


The RPC method upserts ERC20 tokens received via RPC without asking the user for confirmation. This would allow a connected dapp to insert/change ERC20 token information anytime. This can even be more problematic when multiple dapps are connected to the StarkNet-Snap (race conditions).


**packages/starknet-snap/src/addErc20Token.ts:L30-L47**



```
 validateAddErc20TokenParams(requestParamsObj, network);

 const erc20Token: Erc20Token = {
 address: tokenAddress,
 name: tokenName,
 symbol: tokenSymbol,
 decimals: tokenDecimals,
 chainId: network.chainId,
 };

 await upsertErc20Token(erc20Token, wallet, saveMutex);

 console.log(`addErc20Token:\nerc20Token: ${JSON.stringify(erc20Token)}`);
 return erc20Token;
} catch (err) {
 console.error(`Problem found: ${err}`);
 throw err;
}

```
#### Recommendation


Ask the user for confirmation when changing the snaps state.
