# Unrestricted Validator Registration May Lead To DoS

## Summary
The Ditto protocol has a bug where a malicious user can register a large number of fake validators, causing an increase in gas usage and potentially preventing the protocol from operating. To fix this issue, a hard limit on the number of validators will be imposed and active validators will be required to maintain a minimum level of activity or stake. Additionally, the protocol will launch with the whitelist feature enabled and a configuration parameter will be implemented to set a maximum number of validators.

## Details
## Validator Security in the Ditto Protocol

Validators can join the Ditto protocol by invoking `ditto_staking::add_validator`. When the validator whitelist is disabled, there are no restrictions on validator entry. Each new validator occupies space in the `ValidatorState` table and `ValidatorLockupBuffer` stored on the `@ditto_staking` account. Many of the computations that interact with validator state run linear time algorithms over these structures and therefore require gas usage roughly linear to the number of validators.

## Risk of Malicious Validation

A malicious user could register a large number of fake validators in order to increase the usage of the associated validator tables and therefore increase the computation requirement on all subsequent instructions. In the worst case, a malicious user may be able to register enough validators to hit the computation limit and therefore prevent the protocol from operating entirely.

## Remediation Strategies

- Impose a hard limit on the number of validators.
- Require all active validators to maintain a minimum level of activity or stake, such that a malicious user cannot easily add a bunch of fake validators.

## Patch

After discussion with the team, Ditto will be launching with their whitelist feature enabled for the foreseeable future to mitigate against such attack vectors. Additionally, Ditto has implemented a `max_n_validators` configuration parameter which sets a hard limit on the number of validators.

Â© 2022 OtterSec LLC. All Rights Reserved. 6 / 13
