# Issue While Starting New Epoch In Farming

## Summary
The bug report is about a problem with the end_epoch function in the thala_protocol/farming.move code. This function is responsible for ending the current epoch and starting a new one. However, there is an issue where if an epoch ends earlier than expected, the code sets the epoch_end_seconds to a future time instead of the current time. This makes it impossible to start a new epoch until the future time is reached. The suggested solution is to set the epoch_end_seconds to the current time instead. This issue has been fixed in the code.

## Details
## End Epoch in Thala Protocol

`end_epoch` in `thala_protocol/farming.move` ends the currently running epoch in order to start a new epoch.

If an epoch ends earlier than `epoch_end_seconds`, the code sets `farming.epoch_end_seconds` to `epoch_now`. If the current epochâ€™s starting time is in the future and ending this epoch is attempted, `farming.epoch_end_seconds` is set to `farming.epoch_start_seconds`, which is the future time even though the epoch has ended immediately. Now, starting another epoch is impossible until we reach `farming.epoch_start_seconds`.

## Remediation

Set `farming.epoch_end_seconds` to `timestamp::now_seconds()` instead, if the epoch ended earlier than `epoch_end_seconds`.

## Patch

Fixed in `af5fc4a` by setting `farming.epoch_end_seconds` to `timestamp::now_seconds()`.
