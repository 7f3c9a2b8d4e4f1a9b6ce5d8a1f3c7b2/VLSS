# Pyth Deployment DOS

## Summary
No summary provided.

## Details
## Vulnerability Analysis

## Issue Overview

Similar to the issue we found in Wormhole, during the initialization of the `pyth` module, it attempts to register an `AptosCoin` account in order to be able to receive fees:

```rust
sources/pyth.move

module pyth::pyth {
    ...
    fun init_internal(...) {
        ...
        coin::register<AptosCoin>(&wormhole);
    }
    ...
}
```

However, `coin::register` is a one-time operation. If `coin::register` has previously been called on this address, this initialization code will abort, and the wormhole program will be unable to initialize.

While it is usually not possible to register coins for users you cannot sign for, the Aptos framework provides a special mechanism to register `AptosCoin` for any user via `aptos_account::create_account`:

```rust
aptos_account.move

public entry fun create_account(auth_key: address) {
    let signer = account::create_account(auth_key);
    coin::register<AptosCoin>(&signer);
}
```

Therefore, with this mechanism, an attacker could register `AptosCoin` for the wormhole program before deployment in order to prevent it from properly initializing.

## Remediation

Check if `AptosCoin` has been registered and conditionally invoke `coin::register` only if it hasn’t been registered.

## Patch

Resolved in commit `124589d`.

© 2022 OtterSec LLC. All Rights Reserved. 6 / 16
