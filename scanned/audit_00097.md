# [10] Unchecked withdrawal amount in vault module

## Summary
No summary provided.

## Details
The function is already restricted with `friend` access and the underlying `primary_fungible_store::withdraw` includes balance checks.

### Proof of concept

The `withdraw` function in `vault.move` allows withdrawing funds without checking if the requested amount is available in the vault:

<https://github.com/code-423n4/2025-01-initia-move/blob/a96f5136c4808f6968564a4592fe2d6ac243a233/vip-module/sources/vault.move# L53-L63>
```

public(friend) fun withdraw(amount: u64): FungibleAsset acquires ModuleStore {
    let module_store = borrow_global_mut<ModuleStore>(@vip);
    assert!(
        module_store.reward_per_stage > 0,
        error::invalid_state(EINVALID_REWARD_PER_STAGE),
    );
    let vault_signer =
        object::generate_signer_for_extending(&module_store.extend_ref);
    primary_fungible_store::withdraw(&vault_signer, reward_metadata(), amount)
}
```

While this might be safe because `primary_fungible_store::withdraw` in `vip.move` includes internal balance checks, itâ€™s still best practice to validate the withdrawal amount against the available balance at the vault level for explicit safety guarantees.

### Recommended mitigation steps

Add a balance check before performing the withdrawal.

---
