# Denial Of Service Due To Excessive Gas Consumption

## Summary
The vulnerability in this report is caused by an attacker flooding the order book with a large number of small orders, which can cause a high number of remove operations and exceed the max_computation_budget limit. This can block legitimate traders from executing their orders. To fix this issue, the number of orders per account and per transaction should be limited. The vulnerability has been resolved in two pull requests.

## Details
## Vulnerability Overview

The vulnerability lies in the potential for a malicious actor to exploit the `max_computation_budget` limit by flooding the order book with a large number of small orders. Each time an order is fully filled, the `process_maker_fill` removes an `order_id` from the open order list of the maker. A malicious actor may create a large number of small orders at a specific price level. When a large market order is placed against this price level, a cascade of order matches occurs, resulting in a high number of `vec_set::remove` operations.

> _account.moverust_

```rust
public(package) fun process_maker_fill(self: &mut Account, fill: &Fill) {
    [...]
    if (fill.expired() || fill.completed()) {
        self.open_orders.remove(&fill.maker_order_id());
    }
}
```

If the gas consumption exceeds the `max_computation_budget` limit, the transaction will fail, effectively blocking legitimate orders. Thus, the attacker prevents legitimate traders from executing their orders by exploiting the fact that the time complexity of `vec_set::remove` is O(n).

## Remediation

Limit the number of orders that a single account can have and the number of orders that can be executed per transaction.

## Patch

Resolved in PR #204 and PR #220.

Â© 2024 Otter Audits LLC. All Rights Reserved. 11/27
