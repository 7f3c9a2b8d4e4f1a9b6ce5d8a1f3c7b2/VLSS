# Division by Zero in Committee Selection

## Summary
The report describes a bug in the staking_inner::select_committee_and_calculate_votes function, where a division by zero can occur when calculating capacity_vote. This happens when the weight is equal to zero, which represents the number of shards assigned to a node in the next epoch. If a node's staked amount is too low, it may not receive any shard assignments, causing the voting mechanism to fail. The bug has been fixed in the latest patch.

## Details
## Division by Zero Issue in `staking_inner::select_committee_and_calculate_votes`

In `staking_inner::select_committee_and_calculate_votes`, a division by zero may occur when calculating `capacity_vote` if `weight` is zero. The calculation of `capacity_vote` divides the product of `node_capacity` and the number of shards by `weight`. `weight` represents the number of shards assigned to a node in the next epoch. If a nodeâ€™s staked amount is too low, it may not receive any shard assignments, resulting in `shard_assignments[idx].length` returning zero and preventing the voting mechanism from progressing.

> _sources/staking/staking_inner.move rust_

```rust
/// Selects the committee for the next epoch.
public(package) fun select_committee_and_calculate_votes(self: &mut StakingInnerV1) {
    [...]
    node_ids.length().do!(|idx| {
        [...]
        // perform calculation of the votes
        write_prices.insert(pool.write_price(), weight);
        storage_prices.insert(pool.storage_price(), weight);
        let capacity_vote = (pool.node_capacity() * (self.n_shards as u64)) / weight;
        capacity_votes.insert(capacity_vote, weight);
    });
    [...]
    self.next_epoch_params = option::some(epoch_params);
}
```

## Remediation

Skip the `capacity_vote` calculation if the `weight` is 0.

## Patch

Fixed in a1e81c6.
