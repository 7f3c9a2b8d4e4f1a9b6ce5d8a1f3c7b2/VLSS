# Code Refactoring

## Summary
No summary provided.

## Details
## Staking Pool Code Review and Remediation

## 1. Redundant Check in `staking_pool::destroy_empty`

The function `staking_pool::destroy_empty` checks `pending_stakes` twice: once by calling `pool.is_empty()` and again at the end of the function. It is recommended to remove the redundant check for `pending_stakes`.

> _Source: `sources/system/staking_pool.move` (Rust)_
```rust
/// Destroy the pool if it is empty.
public(package) fun destroy_empty(pool: StakingPool) {
    assert!(pool.is_empty(), EPoolNotEmpty);
    [...]
    let (_epochs, pending_stakes) = pending_stake.unwrap().into_keys_values();
    pending_stakes.do!(|stake| assert!(stake == 0));
}
```

## 2. Withdrawal Abort in `staking::withdraw_node`

The current implementation of `staking::withdraw_node` will always abort because both functions call `set_withdrawing`. To resolve this issue, add a check to verify if the node is already in the withdrawing state.

## 3. Next Commission Trigger in `EpochState`

Currently, if `EpochState` is set to `NextParamsSelected`, deposits and withdrawals will be activated in `current_epoch + 2`. Therefore, `set_next_commission` should be triggered in `current_epoch + 3` to allow all users to react appropriately.

## Remediation

Incorporate the above refactors into the codebase.

## Patch

1. Issue #1 has been fixed in commit `cc4aaaa`.
2. Issue #2 has been fixed in commit `cc4aaaa`.
