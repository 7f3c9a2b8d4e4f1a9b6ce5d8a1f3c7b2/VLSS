# Code Clarity

## Summary
No summary provided.

## Details
## Code Review Summary

## Issues Identified

1. In the `quote` module, `amount_out_net`, `amount_out_net_of_protocol_fees`, `output_fee_rate`, and `amount_out_net_of_pool_fees` perform subtraction on `amount_out` by the respective fees (`protocol_fees` and `pool_fees`). However, there is no validation to ensure that the amount of fees does not exceed `amount_out`. If this occurs, it will result in an underflow.

2. The function `quote::output_fee_rate` divides `total_fees` by `amount_out` (the amount of tokens to be swapped). However, there is no check to prevent division by zero if `amount_out` is zero.
   > ```rust
   > // File: steamm/sources/quote.move
   > public fun output_fee_rate(swap_quote: &SwapQuote): Decimal {
   >    let total_fees = decimal::from(
   >        swap_quote.output_fees().pool_fees() + swap_quote.output_fees().protocol_fees(),
   >    );
   >    total_fees.div(decimal::from(swap_quote.amount_out()))
   > }
   > ```

3. In the `bank` module, the `EUtilisationRangeBelowHundredPercent` error seems to indicate an issue where the utilization rate is below 100%. However, the actual error is about indicating when the utilization range is below zero. The correct error should be utilized.

4. The naming of `math::safe_compare_mul_u64` seems inaccurate, as according to the returned data, it is a greater than or equal to function, and not a compare function.
   > ```rust
   > // File: steamm/sources/math.move
   > public (package) fun safe_compare_mul_u64(a1: u64, b1: u64, a2: u64, b2: u64): bool {
   >    let left = (a1 as u128) * (b1 as u128);
   >    let right = (a2 as u128) * (b2 as u128);
   >    left >= right
   > }
   > ```

## Remediation Steps

1. Add validation to ensure `amount_out` and `output_fees` calculations do not abort.
2. Assert `amount_out` is not zero in `quote::output_fee_rate`.
3. Utilize the correct error in the `bank` module.
4. Modify the name of `math::safe_compare_mul_u64` to accurately represent its functionality.

## Patch Status

1. Issue #2 resolved in commit `0aa893f`.
2. Issue #3 resolved in commit `cc20935`.
3. Issue #4 resolved in commit `1a36800`.
