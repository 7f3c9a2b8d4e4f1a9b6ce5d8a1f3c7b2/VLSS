# General Code Refactors

## Summary
No summary provided.

## Details
## Laminar Markets Audit 05 | General Findings

1. It was noticed that some of the functions were implemented for the sole purpose of testing. It’s better to mark those functions `test_only` so that they won’t get compiled into binary.
   - `place_limit_order_return_id`
   - `place_market_order_return_id`
   - `get_order`
   - `has_order`
   - `get_bids_book_top`
   - `get_asks_book_top`

2. Redundant Code Blocks.

   **RUST**
   ```rust
   public entry fun cancel_order<Base, Quote>(
       account: &signer, book_owner: address, id_creation_num: u64,
       side: u8
   ) acquires [..] { // verify order is owned by signer
       let signer_addr = signer::address_of(account);
       let id = guid::create_id(signer_addr, id_creation_num);
       let creator_addr = guid::id_creator_address(&id);
       let signer_addr = signer::address_of(account);
       assert!(creator_addr == signer_addr, EINVALID_ORDER_OWNER);
       [..]
   }
   ```

   1. In the functions, `book::cancel_order` and `book::amend_order`, the `creator_address` and `signer_addr` are going to be the same; it’s redundant to check.
   2. Duplicate initialization of `signer_addr` in `cancel_order`.

3. In the function `book::create_orderbook`, there is a helper function that does the below operation of registering coins, `register_coins_if_missing<Base, Quote>(account)`

   **RUST**
   ```rust
   public entry fun create_orderbook<Base, Quote>([..]) {
       if (!coin::is_account_registered<Base>(book_signer_addr)) {
           coin::register<Base>(&book_signer);
       };
       if (!coin::is_account_registered<Quote>(book_signer_addr)) {
           coin::register<Quote>(&book_signer);
       };
   }
   ```

© 2022 OtterSec LLC. All Rights Reserved. 16 / 22
