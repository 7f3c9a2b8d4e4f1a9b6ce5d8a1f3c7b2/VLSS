# Code Refactoring

## Summary
No summary provided.

## Details
## Governance and Pegging Update

## Issues Identified

1. **Governance Issues**
   - The `governance::update_reward_incentives` function does not validate the `incentives_percent` parameter before updating the incentives percentage in the `AmnisGovernance` resource. Similarly, the `pegging::config_pegging` function does not validate the `max_reserve` and `loan_fee` parameters before updating them in the `AmnisPegging` resource. This lack of validation opens up the possibility of setting unreasonable or unintended values for these parameters, adversely affecting the protocol.

     ```rust
     > _pegging.move rust
     public entry fun config_pegging(operator: &signer, max_reserve: u64, loan_fee: u64)
     ,→ acquires AmnisPegging {
         assert!(signer::address_of(operator) == pegging().operator, ENOT_OPERATOR);
         borrow_global_mut<AmnisPegging>(@amnis).max_reserve = max_reserve;
         borrow_global_mut<AmnisPegging>(@amnis).loan_fee = loan_fee;
     }
     ```

2. **Duplicate Addresses in Stake Pools**
   - There may be duplicate addresses within the `stake_pools` vector passed to the `delegation_manager::vote_stake_pools`. Due to duplicate addresses, only the last corresponding vote for each duplicate address will take effect, while all of them are added to the total weight, resulting in inconsistencies in the total weight of the votes.

## Remediation

1. Add validation checks for the above-mentioned parameters.
2. Check for duplicate elements in the `stake_pools` vector.

## Patch

Fixed in commit `44d5605`.

---

© 2024 Otter Audits LLC. All Rights Reserved. 8/10
