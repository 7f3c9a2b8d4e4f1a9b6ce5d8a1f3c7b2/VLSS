# Sequential Search Leads To Gas Griefing

## Summary
The bug report discusses an issue with the registration process for Momentum Safes. When confirming a registration, the address is removed from a pending vector using a linear search. However, this can cause the vector to grow and create a vulnerability for an attacker to register a Momentum Safe and cause future operations to become more expensive for the victim. The report suggests using a table instead of a vector to store the pending addresses as a solution. This issue has been fixed in version 997875e.

## Details
## Momentum Safe Registration Confirmation

When confirming a Momentum Safe registration, the address is removed from the pending vector of the ownerâ€™s `OwnerMomentumSafes` using a linear search. As anyone can register Momentum Safes for the owner, this causes the pending vector to grow.

**Note:** An attacker can register a Momentum Safe in O(1) time, but all future operations will cost O(n) for the victim. This asymptotic difference makes it a viable gas-griefing attack vector.

## RUST Code Snippet

```rust
fun confirm_pending_msafe(
    owner: address,
    msafe: address,
) acquires OwnerMomentumSafes, RegisterEvent {
    assert!(exists<OwnerMomentumSafes>(owner), EADDRESS_NOT_REGISTRERED);
    let pendings = &mut borrow_global_mut<OwnerMomentumSafes>(owner).pendings;
    let (exist, index) = vector::index_of(pendings, &msafe);
    assert!(exist, EMSAFE_NOT_REGISTERED);
    vector::swap_remove(pendings, index);
    add_momentum_safe(owner, msafe);
}
```

## RUST Code Snippet for Index

```rust
public fun index_of<Element>(v: &vector<Element>, e: &Element): (bool, u64) {
    let i = 0;
    let len = length(v);
    while (i < len) {
        if (borrow(v, i) == e) return (true, i);
        i = i + 1;
    };
    (false, 0)
}
```

This operation of finding the Momentum Safe address in the vector could consume an unbounded amount of gas.

---

## Momentum Safe Audit 04 | Vulnerabilities

### Remediation

Instead of using a vector to store the pending addresses, consider a table.

### Patch

Fixed in `997875e`.
