# A malicious user can grief a `StakePet` contract by creating massive number of pets

## Summary
This bug report concerns the `StakePet::create` function, which allows for the minting of a pet Non-Fungible Token (NFT) by depositing collateral. The bug arises because the function has no minimum deposit requirement, exposing it to potential abuse. A malicious user can exploit this by minting an excessive number of NFTs. This could strain functions like `StakePetManager::buryAllDeadPets`, which calls `StakePetManager::getDeadNonBuriedPets`. This latter function iterates through all pet IDs to identify dead but not yet buried pets, potentially consuming all available gas and resulting in an out-of-gas exception.

To mitigate this issue, it's recommended to introduce a minimum deposit requirement for the creation of a new pet. This would make mass-minting cost-prohibitive for attackers. The client has fixed the bug in commit [a692abc](https://github.com/Ranama/StakePet/commit/a692abc038fdd8992916f93d213a38c30e3a9764), which has been verified.

## Details
**Severity:** Medium

**Description:** The `StakePet::create` function facilitates the minting of a pet NFT by depositing collateral. However, its lack of a minimum deposit requirement for minting exposes it to potential abuse. A malicious user can exploit this by minting an excessive number of NFTs. Notably, this behaviour can strain functions like `StakePetManager::buryAllDeadPets`, which in turn calls `StakePetManager::getDeadNonBuriedPets`. This latter function iterates through all pet IDs to identify pets that are dead but not yet buried.

**Impact:** When a function processes an extensive and potentially unlimited list of pet IDs, there's a risk of it consuming all available gas. Consequently, it can fail, throwing an out-of-gas exception, which negatively affects users trying to interact with the contract.

**Recommended Mitigation:** To deter such griefing attacks, it's advisable to introduce a minimum deposit requirement for the creation of a new pet. Setting this threshold ensures that the mass-minting strategy becomes cost-prohibitive for attackers.

**Client:** Fixed in commit [a692abc](https://github.com/Ranama/StakePet/commit/a692abc038fdd8992916f93d213a38c30e3a9764).

**Cyfrin:** Verified.
