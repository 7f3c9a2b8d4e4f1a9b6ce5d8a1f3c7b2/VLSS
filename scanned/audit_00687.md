# Instant Unstake Fee Can Be Bypassed

## Summary
No summary provided.

## Details
## Unstaking stAPT

Users can unstake their stAPT instantly or with a delay. In order to unstake instantly, a fee, defined in the configuration parameter `instant_unstake_fee_bps`, is charged. The fee is computed using the `utils::calculate_fee` function:

```move
sources/utils.move
public fun calculate_fee(amount: u64, fee_bps: u64): u64 {
    amount * fee_bps / BPS_DENOMINATOR
}
```

This allows an attacker to pay no fees for small amounts because the fee rounds down to zero. More specifically, whenever the amount is less than `(BPS_DENOMINATOR / fee_bps)`, the fee can be avoided.

## Proof of Concept

Consider `instant_unstake_fee_bps` = 30 basis points (0.3%). An attacker can transfer up to 333 atomic units of Aptos instantly without being charged.

## Remediation

Round fee computation up to ensure it is not profitable for an attacker to bypass the fee in this manner.

## Patch

Fixed in `bea16d3`.

Â© 2022 OtterSec LLC. All Rights Reserved. 7 / 13
