# Code Maturity

## Summary
No summary provided.

## Details
## Recommendations for Code Improvements

1. **Add `orderbook_id` Field**  
   It would be better to add an `orderbook_id` field to the `FillReceipt`, `PostReceipt`, and `OrderInfo` structures. Tracking the `orderbook_id` is beneficial when there are multiple order books, and the receipts or order information need to be associated with a specific order book.

2. **Handle Empty Vector in `min_key`**  
   The `min_key` in `ordered_vec_set` does not handle the case of an empty vector. Thus, add a check to verify that the vector is not empty.

   > _sources/ordered_vec_set.move_  
   /// Return the minimum key in `ord_vec`. Aborts if the set is empty.  
   ```rust
   public fun min_key(ord_vec: &OrderedVecSet): u128 {
       assert!(!is_empty(ord_vec), errors::empty_set());
       let contents = borrow_contents(ord_vec);
       *vector::borrow(contents, 0)
   }
   ```

3. **Adjust Condition in `try_update_twaps` and `try_update_funding`**  
   In `try_update_twaps` and `try_update_funding`, when `book_price_opt` is `none`, `unclipped` is assigned the value of `index_price`. Given that `book_price` and `index_price` are identical in this scenario, invoking `clip_max_book_index_spread` is unnecessary. Therefore, the condition may be adjusted as follows.

   > _perpetuals/sources/market.move_  
   // Apply this modification in `try_update_twaps()` and `try_update_funding()`  
   ```rust
   let book_price = if (option::is_none(&book_price_opt)) {
       index_price
   } else {
       clip_max_book_index_spread(option::destroy_some(book_price_opt), index_price)
   };
   ```

## Remediation  
Incorporate the mentioned suggestions to enhance overall efficiency and maintainability.

Â© 2024 Otter Audits LLC. All Rights Reserved. 19/21
