# Improper Oracle Update

## Summary
No summary provided.

## Details
## Update Pool State Documentation

`pool::update_pool_state` is responsible for updating the state of the liquidity pool after a swap operation occurs. In the current code, `oracle::update` is called after the pool’s `current_tick_index` and `current_sqrt_price` have been updated based on the swap result. This timing will result in the recording of inaccurate and misleading data in the oracle regarding the pool’s state before the swap occurred, rendering the data inconsistent.

> **Source:** `sources/pool.move`
```move
fun update_pool_state<CoinTypeA, CoinTypeB>(
    pool: &mut Pool<CoinTypeA, CoinTypeB>, 
    swap_result: SwapResult, 
    current_time: u64
) {
    // current tick index of pool is not the same as swap result
    if (!i32::eq(pool.current_tick_index, swap_result.current_tick_index)) {
        pool.current_sqrt_price = swap_result.end_sqrt_price;
        pool.current_tick_index = swap_result.current_tick_index;
        oracle::update(
            &mut pool.observations_manager,
            pool.current_tick_index,
            pool.liquidity,
            current_time,
        );
    } else {
        pool.current_sqrt_price = swap_result.end_sqrt_price;
    };
    [...]
}
```

## Remediation
Call `oracle::update` before updating `current_tick_index`.

## Patch
Resolved in `f9025e9`.
