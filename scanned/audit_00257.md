# Code Maturity

## Summary
No summary provided.

## Details
## Audit Findings

## General Findings

1. In book, the current implementation of `get_level2_range_and_ticks` lacks a check for expired orders, which allows expired orders to be handled as valid.
  
2. While calculating `const::MAX_PRICE`, `const::MAX_U64`, and `book::START_BID_ORDER_ID`, due to operator precedence, the subtraction is performed before the left shift. This may yield unexpected results if the intention is to calculate the maximum value.

3. An Immediate-or-Cancel (IOC) order is an order that must be executed immediately. If not fully executed, any unfilled portion is canceled and not placed on the order book. Given the nature of IOC orders, adding the order to the account’s order book is unnecessary. If the order is fully executed, there is no remaining order to track. If it is partially or not executed, it is canceled and should not be added to the order book.

    ```rust
    > _state.move_rust
    public(package) fun process_create(
        self: &mut State,
        order_info: &mut OrderInfo,
        ctx: &TxContext,
    ): (Balances, Balances) {
        [...]
        if (order_info.remaining_quantity() > 0) {
            account.add_order(order_info.order_id());
        };
        [...]
    }
    ```

4. `pool::get_quantity_out` fails to explicitly ensure that the parameters retrieved from the governance module belong to the current epoch. This may result in incorrect calculations if the trade parameters have changed since the pool was created or last updated.

## Remediation

1. Update `get_level2_range_and_ticks` to skip expired orders encountered during the iteration process, similar to `mid_price`.

2. Ensure the above constants are calculated as intended.

3. Modify the checks such that only limit orders are added to the account’s order book.

4. Explicitly fetch the trade parameters for the current epoch in `get_quantity_out`.

© 2024 Otter Audits LLC. All Rights Reserved. 24/27  
My sten Deepbook Audit 05 — General Findings

## Patch

1. Resolved in PR #173.
  
2. Resolved in PR #174.
  
3. Resolved in PR #189.

© 2024 Otter Audits LLC. All Rights Reserved. 25/27
