# Unaccounted Rounding Errors In Restake Functionality

## Summary
No summary provided.

## Details
## Delegation Manager: Restake Functionality

`delegation_manager::restake` calculates the amount of pending inactive stake to restake (`restake_amount`) based on the minimum between the remaining amount to restake (`remain_amount`) and the available pending inactive stake. However, it does not account for rounding errors originating from `delegation_pool::reactivate_stake`, leading to cases where the pool covers these losses.

> _delegation_manager rust_

```rust
public(friend) fun restake(amount: u64): u64 acquires DelegationManager, DelegationRecord {
    [...]
    vector::for_each(all_delegations, |delegation| {
        let delegation = *delegation_record_data(delegation);
        let (_, _, pending_inactive) = delegation_pool::get_stake(
            delegation.stake_pool,
            delegation_manager_address()
        );
        if (pending_inactive > 0 && remain_amount > 0) {
            let restake_amount = math64::min(remain_amount, pending_inactive);
            delegation_pool::reactivate_stake(delegation_signer(),
                delegation.stake_pool, restake_amount);
            update_state(delegation.stake_pool);
            remain_amount = remain_amount - restake_amount;
        };
    });
    remain_amount
}
```

## Remediation

Update `restake` to track rounding errors in the same way as `unstake`.

## Patch

Fixed in `44d5605`.

Â© 2024 Otter Audits LLC. All Rights Reserved. 5/10
