# Missing Chain ID Validation

## Summary
This bug report discusses an issue with assigning chain ids to networks. The report explains that the current code allows for a chain id of 0 to be accidentally assigned, which can cause problems when transactions are replayed from one chain to another. The report recommends remediation by validating the chain id in a specific function and provides a code patch to fix the issue. The bug has been fixed in version 6f30e62. It is important to properly validate chain ids to prevent potential problems with transactions.

## Details
## Chain ID and Transaction Safety

In order to uniquely identify a network, a chain ID is assigned.

## Rust Code Example

```rust
pub enum NamedChain {
    /// Users might accidentally initialize the ChainId field to 0, hence
    /// reserving ChainId 0 for accidental initialization.
    /// MAINNET is the Aptos mainnet production chain and is reserved for
    /// 1
    MAINNET = 1,
    // Even though these CHAIN IDs do not correspond to MAINNET, changing
    // them should be avoided since they can break test environments for various organisations.
    TESTNET = 2,
    DEVNET = 3,
    TESTING = 4,
    PREMAINNET = 5,
}
```

Transactions can be replayed from one chain to another if this field isnâ€™t properly validated. In the context of a multisig, the transaction can be added but will fail at execution. Nonetheless, this represents a potential UX risk and is worth remediating.

## Remediation

Validate `chain_id` in the `validate_txn_payload` function.

## Diff Example

```diff
--- a/move/sources/momentum_safe.move
+++ b/move/sources/momentum_safe.move
@@ -332,6 +332,9 @@ module msafe::momentum_safe {
 let cur_sn = account::get_sequence_number(msafe_address);
 assert!(cur_sn <= tx_sn, EMSAFE_TX_SEQUENCE_NUMBER_INVALID);
+ // replace 1337 with the desired chain id and 7331 with a custom
+ // abort code.
+ assert!(transaction::get_chain_id(&txn) == 1337, 7331);
 
 Momentum Safe Audit 04 | Vulnerabilities
 let expire = transaction::get_expiration_timestamp_secs(&txn);
 assert!(expire > utils::now_seconds(), EMSAFE_TX_EXPIRED);
```

## Patch

Fixed in commit `6f30e62`.
