# Unsynchronized Update and Event Emission

## Summary
No summary provided.

## Details
## Liquidity Pool Update Oracle Function

The `liquidity_pool::update_oracle` function emits an event of type `OracleUpdatedEvent` once the update is finalized. The problem is that the place from where the event is launched can be reached even when the update has not happened.

## Code Snippet

```move
sources/libs/stable_curve.move
[...]
if (time_elapsed > 0 && x_reserve != 0 && y_reserve != 0) {
    [...]
    pool.last_price_x_cumulative = *&pool.last_price_x_cumulative + last_price_x_cumulative;
    pool.last_price_y_cumulative = *&pool.last_price_y_cumulative + last_price_y_cumulative;
};
pool.last_block_timestamp = block_timestamp;
let events_store = borrow_global_mut<EventsStore<X, Y, LP>>(pool_addr);
event::emit_event(
    &mut events_store.oracle_updated_handle,
    OracleUpdatedEvent<X, Y, LP> {
        last_price_x_cumulative: pool.last_price_x_cumulative,
        last_price_y_cumulative: pool.last_price_y_cumulative,
    });
```

## Remediation

Move the code sequence responsible for emitting the event to the end of the `if` block mentioned above.

## Patch

Event emit moved right after the update has happened, resolved in commit `637ad72`.

Â© 2022 OtterSec LLC. All Rights Reserved. 10 / 17
