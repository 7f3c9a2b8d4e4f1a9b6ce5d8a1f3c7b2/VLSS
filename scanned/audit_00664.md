# SplayTree Inoperable Remove Functions

## Summary
No summary provided.

## Details
## Function Issues with Node Removal

Functions `remove_nodes_greater_than` and `remove_nodes_less_than` don’t work if provided with values greater than the max node and lesser than the min node, respectively. When the given scenario is met, the deletion of nodes will not occur.

## RUST Implementation

### Remove Nodes Less Than

```rust
public fun remove_nodes_less_than<V: store + drop>(tree, key) {
    while (has_next(&iter)) {
        [..]
        if (key > node.key) {
            vector::push_back(&mut nodes_to_remove, idx);
        } else {
            [..]
        };
    }
}
```

### Remove Nodes Greater Than

```rust
public fun remove_nodes_greater_than<V: store + drop>(tree, key) {
    [..]
    while (has_next(&iter)) {
        [..]
        if (key < node.key) {
            vector::push_back(&mut nodes_to_remove, idx);
        } else {
            [..]
        };
    }
}
```

## Note

This has no impact when used in the context of the order book because the values passed in would always be actual price levels, despite representing a bug in the splay tree.

## Proof of Concept

See Bug POC.

## Remediation

Perform node removals at the end of the function instead of only in the else clause.

## Patch

This patch was addressed in the commit `329c05f`.

© 2022 OtterSec LLC. All Rights Reserved. 12 / 22
