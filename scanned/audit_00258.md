# Code Refactoring

## Summary
No summary provided.

## Details
## Implementation Notes

1. The current implementation of `calculate_order_deep_price` prioritizes the asset with the most recent price point. While this may be suitable in some cases, it may not always be ideal. For instance, there may be situations where utilizing the base asset’s price is preferred, regardless of the last updated timestamp.

2. Staking and unstaking with zero values should be prevented. Processing transactions for zero-value actions wastes computational resources and will also result in unnecessary spam in the network.

3. There is a discrepancy in the checks for order expiration based on a comparison between `expired_timestamp` and `current_timestamp`. The handling of the exact equality case (when `expired_timestamp == current_timestamp`) may be inconsistent across different functions in `order`, `order_info`, and `book`, resulting in unexpected outcomes.

## Remediation

1. `last_insert_timestamp` might return a timestamp for a price point that is older than a specific threshold. Therefore, it is recommended that a mechanism be implemented to filter out such outdated data before making calculations.

2. Implement the above check.

3. Standardize the case when `expired_timestamp == current_timestamp` in `get_quantity_out`, `mid_price`, `get_level2_range_and_ticks`, `validate_inputs`, `order`, and `generate_fill`.

## Patch

1. Issue #2 resolved in PR #221.
2. Issue #3 resolved in PR #190.

© 2024 Otter Audits LLC. All Rights Reserved. 23/27
