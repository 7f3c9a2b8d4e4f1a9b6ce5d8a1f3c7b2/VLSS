# Code Maturity

## Summary
No summary provided.

## Details
## Code Review and Recommendations

## Issues Identified

1. **Max Repaid Amount Adjustment**
   - The `lending_pool::max_repaid_amount` should return zero if the user’s position does not exist, aligning with the behavior of other similar functions.

2. **Redundant MAX_U64 Condition**
   - The `MAX_U64` condition in `borrow` is redundant since it is present in `borrow_internal`.
   ```rust
   _ lending_pool.move
   public(friend) fun borrow(
   [...]
   ): FungibleAsset acquires InterestRate, Fees, LendingPool, Ltv, State, UserPosition {
   [...]
   if (amount == MAX_U64) amount = (max_borrowable_amount(signer::address_of(user), pool)
   ,→ as u64);
   borrow_internal(signer::address_of(user), pool, amount, true)
   }
   ```

3. **Duplicate Error Codes in Meso**
   - In `meso`, both `EALREADY_INITIALIZED` and `ENOT_NATIVE_FA` have the same error code of 4, which will lead to confusion in error handling logic. Error codes should ideally be unique identifiers to clearly distinguish between different types of errors.
   ```rust
   _ meso.move
   module meso::meso {
   [...]
   /// Token is not a native fungible asset
   const ENOT_NATIVE_FA: u64 = 4;
   /// Module already initialized
   const EALREADY_INITIALIZED: u64 = 4;
   [...]
   }
   ```

4. **Disallow Self-Liquidations**
   - Self-liquidations could be disallowed as they serve no practical value and can potentially create unnecessary complications within the system.

## Remediation Steps

1. Update `max_repaid_amount` to return zero if the user’s position does not exist.
2. Remove the `MAX_U64` condition in `borrow`.
3. Utilize unique error codes for each error constant.
4. Update `liquidate` to abort in case the liquidator’s address is the liquidatee’s.

## Patch References

1. Fixed in `728c3ad`.
2. Fixed in `887f2ef`.
3. Fixed in `9ddac56`.
4. Fixed in `d1ac947`.
