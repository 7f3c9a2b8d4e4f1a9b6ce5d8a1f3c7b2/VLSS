# Code Refactoring

## Summary
No summary provided.

## Details
## Vault Rebalancing Guidelines

## 1. Immutable References
`vault::check_rebalance` and `vault::check_rebalance_loop` should avoid utilizing mutable references (`&mut`) for its input parameters to ensure there will be no changes to these objects in these functions.

## 2. Threshold Validation
Threshold setters, in the context of rebalancing strategies, should validate the new threshold value before applying it so that the system becomes more resistant to manipulation attempts and errors due to accidental input invalid values.

## 3. Vault Closure
`vault::close_vault` does not explicitly remove the entry for the closed vault from the `strategy.accounts` linked table, wasting storage.

```rust
> _vault.move_reust
public fun close_vault<CoinTypeA, CoinTypeB>(
    global_config: &GlobalConfig,
    strategy: &mut Strategy,
    vault: Vault,
    ctx: &mut TxContext
) {
    [...]
    assert!(get_vault_balance<CoinTypeA>(strategy, vault_id) == 0, ECoinABalanceGtZero);
    assert!(get_vault_balance<CoinTypeB>(strategy, vault_id) == 0, ECoinBBalanceGtZero);
    remove_vault_info(strategy, vault_id);
    [...]
}
```

## Remediation
1. Ensure `vault::check_rebalance` and `vault::check_rebalance_loop` do not take mutable parameters.
2. Validate the threshold setter functions within the vault.
3. Remove the vault entry from `strategy.accounts` on closing a vault.

Â© 2024 Otter Audits LLC. All Rights Reserved. 14/21
