# Useless Withdraw Operation In Lending

## Summary
No summary provided.

## Details
## Optimization in Lending.move

In `lending.move`, within `repay` and `liquidation_call`, the invocation of `withdraw` may be avoided. Subtracting the `excess_amount` before the deposit operation when calculating the amount deposited avoids the invocation. This optimization eliminates the need for a separate `withdraw` call, resulting in significant gas savings and improved efficiency.

## Code Snippet

```rust
source/lending.move RUST

public entry fun repay<CoinType>(
    clock: &Clock,
    oracle: &PriceOracle,
    storage: &mut Storage,
    pool: &mut Pool<CoinType>,
    asset: u8,
    repay_coin: Coin<CoinType>,
    amount: u64, // e.g. 100USDT(1000000) -> 100 * 1e6
    ctx: &mut TxContext
) {
    when_not_paused(storage);
    let sender = tx_context::sender(ctx);
    let split_coin = utils::split_coin(repay_coin, amount, ctx);
    let repay_value = coin::value(&split_coin);
    pool::deposit(pool, split_coin, ctx);
    let normal_repay_value = pool::normal_amount(pool, repay_value); // e.g. 100USDT(100 * 1e6) -> 100 * 1e9
    validation::validate_repay(storage, asset, amount);
    let excess_amount = logic::execute_repay(clock, oracle, storage, asset, sender, (normal_repay_value as u256));
    
    if (excess_amount > 0) {
        pool::withdraw(pool, (excess_amount as u64), sender, ctx);
    };
    
    emit(RepayEvent {
        reserve: asset,
        sender: tx_context::sender(ctx),
        amount: repay_value
    })
}
```

## Remediation

Subtract the `excess_amount` before the deposit operation and remove the `withdraw` invocation.
