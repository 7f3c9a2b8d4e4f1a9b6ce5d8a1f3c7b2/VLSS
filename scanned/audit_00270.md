# Premature Reward Claiming

## Summary
No summary provided.

## Details
## Vulnerability in claim_rewards

The vulnerability in `claim_rewards` arises from the fact that protocol rewards may be claimed for future epochs or even the current epoch. This is problematic because the rewards for these epochs, as well as the stake distribution, are not yet finalized. Since the total rewards and individual stakes are not finalized for future and current epochs, any claim made during these times may be based on incomplete or inaccurate data. Users may receive more or less than their fair share, resulting in an unfair distribution of rewards.

## Code Snippet

```rust
protocol_reward.move rust
public fun claim_rewards<AssetType>(_user: &signer, _epoch_start_at: u64)
acquires EpochReward, ProtocolRewardEvents, UserRewardInfo {
    let epoch_reward = borrow_global_mut<EpochReward<AssetType>>(@merkle);
    if (!exists<UserRewardInfo<AssetType>>(address_of(_user))) {
        move_to(_user, UserRewardInfo<AssetType> {
            claimed_epoch: vector[] 
        });
    };
    let user_reward_info = borrow_global_mut<UserRewardInfo<AssetType>>(address_of(_user));
    assert!(
        _epoch_start_at % staking::get_epoch_duration() == 0 &&
        !vector::contains(&user_reward_info.claimed_epoch, &_epoch_start_at) &&
        smart_table::contains(&epoch_reward.reward, _epoch_start_at),
        E_NO_CLAIMABLE
    );
    [...]
}
```

Allowing claims before the epoch is finalized will result in inconsistencies in the protocol state. The recorded rewards may not match the actual distributed amounts once the epoch is finalized.

## Remediation

Allow claims for epochs that have ended and ensure that rewards are distributed only after the epoch duration has elapsed and the stake distribution is finalized.

## Patch

Fixed in `906ec95` by ensuring that rewards can only be claimed for past epochs.
