### Title
Missing Version Migration Function for ValidatorPool Causes Protocol-Wide DoS After Package Upgrade

### Summary
The `ValidatorPool` struct contains its own `Manage` instance with version tracking, but lacks a public migration function to update its version after package upgrades. When the package is upgraded with an incremented `VERSION` constant, administrators can only migrate the `StakePool`'s version, leaving `ValidatorPool`'s version outdated. This causes all core staking operations (stake, unstake, rebalance, fee collection) to fail with `EIncompatibleVersion` error, resulting in complete protocol DoS.

### Finding Description

**Root Cause:**

Both `StakePool` and `ValidatorPool` independently store `Manage` instances with version fields: [1](#0-0) [2](#0-1) 

The `Manage` module defines version checking logic: [3](#0-2) 

The `migrate_version()` function requires strict version ordering: [4](#0-3) 

**Missing Migration Path:**

`StakePool` provides a migration function accessible to admins: [5](#0-4) 

However, **no equivalent migration function exists for `ValidatorPool`**. The `ValidatorPool` is encapsulated within `StakePool` with no public access to its `manage` field.

**Failure Path:**

All core operations call `check_version()` on `ValidatorPool.manage`: [6](#0-5) [7](#0-6) 

When users call `stake_entry()`, the execution path is:
1. Line 183: `StakePool.manage.check_version()` → ✓ Passes (migrated)
2. Line 229: Calls `refresh()`
3. Line 514: Calls `validator_pool.refresh()`  
4. Line 180 in validator_pool: `ValidatorPool.manage.check_version()` → ✗ **FAILS** (not migrated) [8](#0-7) [9](#0-8) 

### Impact Explanation

**Complete Protocol DoS:**

After a package upgrade that increments `VERSION`, the following critical functions become permanently unusable:

1. **Staking Operations:** `stake_entry()`, `delegate_stake_entry()` - users cannot stake SUI
2. **Unstaking Operations:** `unstake_entry()` - users cannot withdraw funds
3. **Protocol Maintenance:** `rebalance()`, `collect_fees()` - critical operations fail
4. **Validator Management:** `set_validator_weights()` - cannot rebalance validators

**Affected Parties:**
- All users: Cannot stake or unstake (funds locked)
- Protocol operators: Cannot collect fees or rebalance
- Validators: Cannot adjust weights or distributions

**Severity:** HIGH - The protocol becomes completely non-functional for all core operations. While admin functions like `set_paused()` and `update_fees()` still work, all value-critical operations are blocked.

**No Recovery Path:** Since `ValidatorPool.manage` cannot be accessed, there is no way to migrate it without deploying an entirely new contract and migrating all stakes, which is extremely complex and risky.

### Likelihood Explanation

**Trigger Condition:**
The vulnerability activates when the `VERSION` constant is incremented during a package upgrade. While not every upgrade requires version incrementation, breaking changes to the `Manage` struct or version-checking logic would necessitate it. [10](#0-9) 

**Probability:**
- **Medium-High likelihood** - The codebase already demonstrates version incrementation (VERSION = 2 in manage.move, suggesting it was incremented from 1)
- Standard upgrade procedures documented in README show upgrades are expected: [11](#0-10) 

- Other modules (cert.move, volo_vault.move) have separate VERSION constants at different values, indicating independent versioning per module
- Any future schema-breaking change to `Manage` would require VERSION increment, triggering guaranteed DoS

**Preconditions:**
1. Package is upgraded with `VERSION` constant incremented (e.g., 2 → 3)
2. Admin successfully calls `migrate_version()` on `StakePool`
3. Any user attempts core staking operation

**No Attacker Required:** This is a design flaw triggered by legitimate protocol upgrade operations, not requiring any malicious actor.

### Recommendation

**Immediate Fix:**

Add a public migration function to `ValidatorPool` accessible via `StakePool`:

```move
// In validator_pool.move
public(package) fun migrate_validator_pool_version(
    self: &mut ValidatorPool
) {
    self.manage.migrate_version();
}

// In stake_pool.move  
public fun migrate_validator_pool_version(
    self: &mut StakePool,
    _: &AdminCap
) {
    self.validator_pool.migrate_validator_pool_version();
}
```

**Enhanced Migration Process:**

Create a comprehensive migration function that updates both `StakePool` and `ValidatorPool` in a single transaction:

```move
public fun migrate_all_versions(
    self: &mut StakePool,
    _: &AdminCap
) {
    self.manage.migrate_version();
    self.validator_pool.migrate_validator_pool_version();
}
```

**Test Cases:**

1. Verify version migration for both `StakePool.manage` and `ValidatorPool.manage`
2. Test that all entry functions work after migration
3. Test that version checks fail appropriately before migration
4. Ensure migration can only be called once per version increment

### Proof of Concept

**Initial State:**
- Package deployed with `VERSION = 2`
- `StakePool.manage.version = 2`
- `ValidatorPool.manage.version = 2`
- All operations function normally

**Upgrade Scenario:**
1. Developers upgrade package with `VERSION = 3` for breaking changes
2. Admin calls `stake_pool::migrate_version()` with AdminCap
   - Result: `StakePool.manage.version = 3`, but `ValidatorPool.manage.version = 2`

**Exploit Execution:**
3. User calls `stake_pool::stake_entry()` with valid parameters
   - Expected: Successful stake operation
   - Actual: Transaction aborts at line 180 of validator_pool.move with error code `50001` (EIncompatibleVersion)

4. User calls `stake_pool::unstake_entry()` to withdraw funds
   - Expected: Successful unstake operation  
   - Actual: Transaction aborts with same error - **funds are locked**

5. Operator calls `stake_pool::rebalance()` for maintenance
   - Expected: Successful rebalance
   - Actual: Transaction aborts - **protocol maintenance impossible**

**Success Condition:** Protocol is completely DoS'd for all core value operations after legitimate upgrade, with no recovery mechanism available.

### Citations

**File:** liquid_staking/sources/stake_pool.move (L51-51)
```text
        manage: Manage,
```

**File:** liquid_staking/sources/stake_pool.move (L183-186)
```text
        self.manage.check_version();
        let cert = self.stake(metadata, system_state, sui, ctx);
        transfer::public_transfer(cert, ctx.sender());
    }
```

**File:** liquid_staking/sources/stake_pool.move (L342-344)
```text
    public fun migrate_version(self: &mut StakePool, _: &AdminCap) {
        self.manage.migrate_version();
    }
```

**File:** liquid_staking/sources/stake_pool.move (L503-514)
```text
    public fun refresh(
        self: &mut StakePool, 
        metadata: &Metadata<CERT>,
        system_state: &mut SuiSystemState, 
        ctx: &mut TxContext
    ): bool {
        self.manage.check_version();
        self.manage.check_not_paused();

        let old_total_supply = self.total_sui_supply();

        if (self.validator_pool.refresh(system_state, ctx)) { // epoch rolled over
```

**File:** liquid_staking/sources/validator_pool.move (L50-50)
```text
        manage: Manage,
```

**File:** liquid_staking/sources/validator_pool.move (L175-180)
```text
    public(package) fun refresh(
        self: &mut ValidatorPool, 
        system_state: &mut SuiSystemState, 
        ctx: &mut TxContext
    ): bool {
        self.manage.check_version();
```

**File:** liquid_staking/sources/validator_pool.move (L332-338)
```text
    public (package) fun set_validator_weights(
        self: &mut ValidatorPool,
        validator_weights: VecMap<address, u64>,
        system_state: &mut SuiSystemState,
        ctx: &mut TxContext
    ) {
        self.manage.check_version();
```

**File:** liquid_staking/sources/manage.move (L11-22)
```text
    const VERSION: u64 = 2;

    public(package) fun new(): Manage {
        Manage { version: current_version(), paused: true }
    }

    public fun current_version(): u64 {
        VERSION
    }

    public fun check_version(self: &Manage) {
        assert!(self.version == VERSION, EIncompatibleVersion)
```

**File:** liquid_staking/sources/manage.move (L29-32)
```text
    public(package) fun migrate_version(self: &mut Manage) {
        assert!(self.version <= VERSION, EIncompatibleVersion);
        self.version = VERSION;
    }
```

**File:** README.md (L30-34)
```markdown
**Upgrade**

```bash
sui client upgrade --gas-budget 100000000 --upgrade-capability ${upgradeCap}
```
```
