### Title
Incomplete State Migration in `upgrade_oracle_config()` Causes Critical Operational Failure

### Summary
The `upgrade_oracle_config()` function only updates the version number without initializing or validating critical configuration fields such as `dex_slippage`, aggregator mappings, decimals settings, or update intervals. [1](#0-0)  When upgrading from a previous version where new fields like `dex_slippage` were added, existing OracleConfig objects will have these fields uninitialized (value of 0), causing all Cetus and Momentum adaptor operations to fail with ERR_INVALID_POOL_PRICE, effectively disabling critical vault functionality.

### Finding Description

The `upgrade_oracle_config()` function in the admin management interface [2](#0-1)  delegates to the package-level implementation that performs minimal migration logic. [1](#0-0) 

The function only:
1. Verifies current version is less than target VERSION
2. Updates the version field to VERSION (currently 2)
3. Emits an upgrade event

**Root Cause**: The function fails to initialize or migrate any state fields:
- `dex_slippage`: Should be initialized to DEFAULT_DEX_SLIPPAGE (100) but remains 0
- `aggregators` Table: No validation or migration of existing mappings
- `update_interval`: No validation against MAX_UPDATE_INTERVAL
- PriceInfo entries: No validation of decimals or aggregator addresses

The OracleConfig struct contains these critical fields: [3](#0-2) 

When new fields like `dex_slippage` are added in VERSION 2, Sui's upgrade mechanism initializes them to default values (0 for u256). The upgrade function should set `dex_slippage` to DEFAULT_DEX_SLIPPAGE (100 = 1% tolerance), [4](#0-3)  but it does not.

**Why Existing Protections Fail**: 
Both Cetus and Momentum adaptors retrieve `dex_slippage` and use it in a critical pool price validation assertion. In the Cetus adaptor: [5](#0-4) 

The slippage tolerance calculation becomes: `(DECIMAL * 0 / SLIPPAGE_BASE) = 0`, meaning the assertion requires pool price deviation to be less than 0%, which is impossible for any real price difference. The same issue exists in the Momentum adaptor: [6](#0-5) 

SLIPPAGE_BASE is defined as 10,000 (representing 100%): [7](#0-6) 

### Impact Explanation

**Operational Impact - Critical DoS**:
- After upgrading OracleConfig from v1 to v2 without proper migration, `dex_slippage` remains 0
- ALL operations using Cetus adaptor fail with ERR_INVALID_POOL_PRICE
- ALL operations using Momentum adaptor fail with ERR_INVALID_POOL_PRICE  
- Vault cannot start operations that borrow/return assets via these adaptors
- Vault operations become stuck, preventing normal deposit/withdrawal cycles
- Asset value updates for Cetus and Momentum positions fail

**Who Is Affected**:
- All users with pending withdrawal requests requiring these adaptors
- Operators unable to execute vault operations
- Protocol unable to rebalance or manage DeFi positions
- Vault effectively in degraded state until manual intervention

**Severity Justification**: HIGH
- Not direct fund theft, but complete operational failure
- Breaks critical invariant: "All borrowed DeFi assets returned"
- Violates operational requirements for adaptor functionality
- Affects core vault operation lifecycle
- Requires emergency fix to restore functionality

### Likelihood Explanation

**Realistic Exploitability**: This is not an attack scenario but a critical migration bug that occurs through normal protocol upgrade procedures.

**Preconditions**:
1. OracleConfig exists from VERSION 1 (before `dex_slippage` field was added)
2. Protocol is upgraded to VERSION 2 which adds new fields
3. Admin calls `upgrade_oracle_config()` as part of normal upgrade process
4. All these are expected, documented upgrade steps

**Execution Path**:
1. Admin upgrades package to v2 via Sui package upgrade
2. Admin calls `vault_manage::upgrade_oracle_config()` [2](#0-1) 
3. Function updates version but leaves `dex_slippage = 0`
4. Next operation attempt using Cetus/Momentum fails at price check

**Probability**: Very High
- This occurs on EVERY upgrade from v1→v2 if dex_slippage was added in v2
- Not dependent on attacker actions
- Built into the upgrade flow
- VERSION constant = 2 indicates this scenario has occurred or will occur [8](#0-7) 

### Recommendation

**Immediate Fix**: Modify `upgrade_oracle_config()` to properly initialize all fields that were added in version upgrades:

```move
public(package) fun upgrade_oracle_config(self: &mut OracleConfig) {
    assert!(self.version < VERSION, ERR_INVALID_VERSION);
    
    // Initialize dex_slippage if unset (0)
    if (self.dex_slippage == 0) {
        self.dex_slippage = DEFAULT_DEX_SLIPPAGE;
    };
    
    // Validate update_interval is within bounds
    if (self.update_interval > MAX_UPDATE_INTERVAL || self.update_interval == 0) {
        self.update_interval = MAX_UPDATE_INTERVAL;
    };
    
    self.version = VERSION;
    emit(OracleConfigUpgraded {
        oracle_config_id: self.id.to_address(),
        version: VERSION,
    });
}
```

**Additional Validations**:
1. Add assertion that `dex_slippage >= minimum_slippage` (e.g., 10 = 0.1%)
2. Validate all existing aggregator mappings still have valid addresses
3. Add test coverage for upgrade scenarios from each previous version

**Test Cases to Prevent Regression**:
```move
#[test]
fun test_upgrade_initializes_dex_slippage() {
    // Create v1 config with dex_slippage = 0
    // Call upgrade_oracle_config
    // Assert dex_slippage == DEFAULT_DEX_SLIPPAGE
}

#[test]
fun test_cetus_adaptor_works_after_upgrade() {
    // Upgrade oracle config
    // Attempt Cetus position value update
    // Should not fail with ERR_INVALID_POOL_PRICE
}
```

### Proof of Concept

**Initial State**:
- OracleConfig deployed at VERSION 1 without `dex_slippage` field
- Aggregators configured for SUI, USDC, BTC
- Vault has active Cetus CLMM positions

**Exploitation Steps**:
1. Admin upgrades package from v1 to v2 (adds `dex_slippage` field to OracleConfig)
2. Admin calls `upgrade_oracle_config()` 
   - Version updates from 1 → 2
   - `dex_slippage` remains 0 (default u256 value)
3. Operator attempts vault operation: `start_operation()` → borrow assets via Cetus adaptor
4. Cetus adaptor calls `update_cetus_position_value()` 
5. Price validation executes with `slippage = 0`
6. Assertion fails: `pool_price_diff < 0` is impossible
7. Transaction aborts with ERR_INVALID_POOL_PRICE

**Expected vs Actual Result**:
- **Expected**: `dex_slippage` initialized to 100 (1% tolerance), operations succeed
- **Actual**: `dex_slippage` remains 0, ALL Cetus/Momentum operations fail indefinitely

**Success Condition**: 
The vault is unable to execute any operations involving Cetus or Momentum positions until manual administrative intervention sets `dex_slippage` via a separate transaction using `set_dex_slippage()`. [9](#0-8)

### Citations

**File:** volo-vault/sources/oracle.move (L11-11)
```text
const VERSION: u64 = 2;
```

**File:** volo-vault/sources/oracle.move (L14-14)
```text
const DEFAULT_DEX_SLIPPAGE: u256 = 100; // 1%
```

**File:** volo-vault/sources/oracle.move (L31-37)
```text
public struct OracleConfig has key, store {
    id: UID,
    version: u64,
    aggregators: Table<String, PriceInfo>,
    update_interval: u64,
    dex_slippage: u256, // Pool price and oracle price slippage parameter (used in adaptors related to DEX)
}
```

**File:** volo-vault/sources/oracle.move (L100-108)
```text
public(package) fun upgrade_oracle_config(self: &mut OracleConfig) {
    assert!(self.version < VERSION, ERR_INVALID_VERSION);
    self.version = VERSION;

    emit(OracleConfigUpgraded {
        oracle_config_id: self.id.to_address(),
        version: VERSION,
    });
}
```

**File:** volo-vault/sources/oracle.move (L117-122)
```text
public(package) fun set_dex_slippage(config: &mut OracleConfig, dex_slippage: u256) {
    config.check_version();

    config.dex_slippage = dex_slippage;
    emit(DexSlippageSet { dex_slippage })
}
```

**File:** volo-vault/sources/manage.move (L33-38)
```text
public fun upgrade_oracle_config(
    _: &AdminCap,
    oracle_config: &mut OracleConfig,
) {
    oracle_config.upgrade_oracle_config();
}
```

**File:** volo-vault/sources/adaptors/cetus_adaptor.move (L15-15)
```text
const SLIPPAGE_BASE: u256 = 10_000; // 10000 = 100%
```

**File:** volo-vault/sources/adaptors/cetus_adaptor.move (L62-66)
```text
    let slippage = config.dex_slippage();
    assert!(
        (pool_price.diff(relative_price_from_oracle) * DECIMAL  / relative_price_from_oracle) < (DECIMAL  * slippage / SLIPPAGE_BASE),
        ERR_INVALID_POOL_PRICE,
    );
```

**File:** volo-vault/sources/adaptors/momentum.adaptor.move (L54-58)
```text
    let slippage = config.dex_slippage();
    assert!(
        (pool_price.diff(relative_price_from_oracle) * DECIMAL  / relative_price_from_oracle) < (DECIMAL  * slippage / SLIPPAGE_BASE),
        ERR_INVALID_POOL_PRICE,
    );
```
