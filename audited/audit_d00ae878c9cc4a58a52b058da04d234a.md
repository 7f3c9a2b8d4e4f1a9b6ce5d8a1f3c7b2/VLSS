### Title
Version Lock DoS in Switchboard Aggregator Actions Causes Permanent Inability to Manage New Aggregators

### Summary
When the Switchboard aggregator module is upgraded with a new VERSION constant but the action modules are not simultaneously updated with matching EXPECTED_AGGREGATOR_VERSION values, all newly created aggregators become permanently unusable. The aggregator's version field cannot be modified after creation, causing all management operations (authority transfers, configuration updates, deletions, and result submissions) to permanently revert with version mismatch errors.

### Finding Description

The Switchboard aggregator system has a critical version synchronization issue across multiple modules:

**Root Cause - Immutable Version Field:**

The Aggregator struct contains a `version` field that is set once during creation to the VERSION constant (currently 1): [1](#0-0) [2](#0-1) [3](#0-2) 

There is NO function in the aggregator module to update this version field after creation. The only mutator functions are `set_authority()` and `set_configs()`, which do not modify the version: [4](#0-3) [5](#0-4) 

**Version Validation in All Action Modules:**

Every aggregator action module validates the version before allowing operations:

1. **Authority Transfer Action** validates version in the `validate()` function: [6](#0-5) [7](#0-6) 

2. **Configuration Update Action** has identical validation: [8](#0-7) [9](#0-8) 

3. **Delete Action** validates version: [10](#0-9) [11](#0-10) 

4. **Submit Result Action** validates version: [12](#0-11) [13](#0-12) 

**Upgrade Evidence:**

Switchboard is deployed and upgradeable on both mainnet and testnet with documented UpgradeCap addresses and historical upgrades: [14](#0-13) [15](#0-14) 

### Impact Explanation

**Complete Permanent DoS of Aggregator Operations:**

If Switchboard upgrades the aggregator module and changes the VERSION constant from 1 to 2 (or any other value), but does not simultaneously upgrade all four action modules to match, the following occurs:

1. **All newly created aggregators** will have `version = 2`
2. **All action modules** still expect `version = 1` 
3. **Every operation permanently fails** with `EInvalidAggregatorVersion`:
   - Authority transfers cannot be executed
   - Configuration cannot be updated
   - Aggregators cannot be deleted (permanent object lock)
   - Oracle results cannot be submitted (breaking price feed functionality)

**No Recovery Mechanism:**

Because no `set_version()` function exists in the aggregator module, there is absolutely no way to "fix" affected aggregators. They become permanently bricked shared objects on-chain that:
- Cannot receive price updates (breaking oracle functionality)
- Cannot transfer authority (users permanently locked out)
- Cannot be reconfigured (wrong feed parameters cannot be corrected)
- Cannot be deleted (permanent on-chain storage consumption)

**Systemic Risk:**

This affects the entire Switchboard oracle ecosystem integrated into the Volo protocol. If Volo's vault relies on Switchboard aggregators for pricing, newly created price feeds would be non-functional, potentially requiring emergency oracle provider switches or vault operation halts.

### Likelihood Explanation

**Highly Probable Upgrade Scenario:**

The likelihood of this vulnerability being triggered is **HIGH** because:

1. **Historical Precedent**: Switchboard has already undergone multiple upgrades as evidenced by the "First Publish", "Second Publish", and "Third Publish" records in both mainnet and testnet configurations.

2. **Package Structure Complexity**: The version validation is spread across 4 separate action modules that must all be updated atomically when the aggregator module's VERSION changes. This is error-prone during routine upgrades.

3. **No Safeguards**: There are no:
   - Compile-time checks ensuring version synchronization
   - Runtime migration paths
   - Version compatibility layers
   - Test coverage validating cross-module version consistency

4. **Operational Reality**: In production package upgrades, developers might:
   - Upgrade the core aggregator module for bug fixes/features
   - Forget that VERSION constant impacts action modules
   - Test only the core module functionality
   - Deploy without realizing action modules need updates

5. **No Attacker Action Required**: This is not an active exploit - it's a passive system failure that occurs during legitimate protocol upgrades by trusted parties, making it inevitable over time.

### Recommendation

**Immediate Fix - Add Version Migration Function:**

Add a package-accessible version setter function in the aggregator module:

```move
public(package) fun set_version(aggregator: &mut Aggregator, new_version: u8) {
    aggregator.version = new_version;
}
```

This allows aggregator authorities to migrate their aggregators after version upgrades.

**Alternative Fix - Remove Version Checks:**

If version checks serve no critical security purpose, remove the `EXPECTED_AGGREGATOR_VERSION` validation from all action modules. This eliminates the synchronization requirement.

**Best Practice - Atomic Upgrade Process:**

Implement upgrade procedures that:
1. Deploy new aggregator module and all action modules in a single upgrade transaction
2. Add integration tests that fail if version constants are misaligned across modules
3. Document version dependencies clearly in upgrade documentation
4. Consider using a global version registry that all modules read from

**Test Coverage:**

Add tests that:
- Verify all action modules can operate on aggregators with VERSION = 2
- Detect version mismatches during CI/CD
- Test version migration paths explicitly

### Proof of Concept

**Initial State:**
- Switchboard deployed with aggregator VERSION = 1
- All action modules have EXPECTED_AGGREGATOR_VERSION = 1
- Existing aggregators functioning normally

**Exploit Steps:**

1. Switchboard team upgrades the aggregator module:
   - Changes `const VERSION: u8 = 2;` in aggregator.move
   - Deploys upgrade using UpgradeCap
   - Forgets to upgrade action modules (they still have EXPECTED_AGGREGATOR_VERSION = 1)

2. User creates new aggregator via `aggregator_init_action::run()`:
   - Aggregator created with `version: 2` (from new VERSION constant)
   - Aggregator shared on-chain

3. User attempts ANY operation on the new aggregator:

   **Authority Transfer:**
   ```
   aggregator_set_authority_action::run(aggregator, new_authority, ctx)
   → validate() called
   → assert!(aggregator.version() == EXPECTED_AGGREGATOR_VERSION)
   → assert!(2 == 1)  // FAILS
   → Aborts with EInvalidAggregatorVersion
   ```

   **Same failure occurs for:**
   - `aggregator_set_configs_action::run()` - Cannot update configuration
   - `aggregator_delete_action::run()` - Cannot delete aggregator
   - `aggregator_submit_result_action::run()` - Cannot submit oracle results

**Expected Result:** Operations succeed normally

**Actual Result:** All operations permanently abort with version mismatch error. Aggregator becomes a permanently bricked shared object with no recovery path.

### Citations

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/schemas/aggregator.move (L10-10)
```text
const VERSION: u8 = 1;
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/schemas/aggregator.move (L77-77)
```text
    version: u8,
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/schemas/aggregator.move (L216-216)
```text
        version: VERSION,
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/schemas/aggregator.move (L223-225)
```text
public(package) fun set_authority(aggregator: &mut Aggregator, new_authority: address) {
    aggregator.authority = new_authority;
}
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/schemas/aggregator.move (L227-240)
```text
public(package) fun set_configs(
    aggregator: &mut Aggregator,
    feed_hash: vector<u8>,
    min_sample_size: u64,
    max_staleness_seconds: u64,
    max_variance: u64,
    min_responses: u32,
) {
    aggregator.feed_hash = feed_hash;
    aggregator.min_sample_size = min_sample_size;
    aggregator.max_staleness_seconds = max_staleness_seconds;
    aggregator.max_variance = max_variance;
    aggregator.min_responses = min_responses;
}
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_set_authority_action.move (L6-6)
```text
const EXPECTED_AGGREGATOR_VERSION: u8 = 1;
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_set_authority_action.move (L19-22)
```text
public fun validate(aggregator: &Aggregator, ctx: &mut TxContext) {
    assert!(aggregator.version() == EXPECTED_AGGREGATOR_VERSION, EInvalidAggregatorVersion);
    assert!(aggregator.has_authority(ctx), EInvalidAuthority);
}
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_set_configs_action.move (L6-6)
```text
const EXPECTED_AGGREGATOR_VERSION: u8 = 1;
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_set_configs_action.move (L41-41)
```text
    assert!(aggregator.version() == EXPECTED_AGGREGATOR_VERSION, EInvalidAggregatorVersion);
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_delete_action.move (L6-6)
```text
const EXPECTED_AGGREGATOR_VERSION: u8 = 1;
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_delete_action.move (L17-20)
```text
public fun validate(aggregator: &Aggregator, ctx: &mut TxContext) {
    assert!(aggregator.version() == EXPECTED_AGGREGATOR_VERSION, EInvalidAggregatorVersion);
    assert!(aggregator.has_authority(ctx), EInvalidAuthority);
}
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_submit_result_action.move (L13-13)
```text
const EXPECTED_AGGREGATOR_VERSION: u8 = 1;
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/sources/actions/aggregator/aggregator_submit_result_action.move (L57-57)
```text
    assert!(aggregator.version() == EXPECTED_AGGREGATOR_VERSION, EInvalidAggregatorVersion);
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/Move.mainnet.toml (L1-16)
```text
[package]
name = "Switchboard"
edition = "2024.beta"
version = "0.0.2"
published-at = "0xe6717fb7c9d44706bf8ce8a651e25c0a7902d32cb0ff40c0976251ce8ac25655"

# Upgrade command:
# sui client upgrade --upgrade-capability <UpgradeCap>

# Old version:
# First Publish: 0x0b884dbc39d915f32a82cc62dabad75ca3efd3c568c329eba270b03c6f58cbd8
# Second Publish: 0x1b03b77082cdb9d6b3febc6294f36d999d8556583616fadc84199a8e66371d60
# Third Publish: 0xbd22434e506314abc0cd981447fbf42139fa04aa09b5a8a7d7789826883e8e0a
# AdminCap: 0xe10be54c1686c5d5e6ccd74b7589a7362e7d075d6e4c513c8af379fdaf4c5f36
# State: 0x90a2829005435005300abaf7ce8115814b38c8d42a6de5aaf311774c60603b68
# UpgradeCap: 0xda0d1de2ce8afde226f66b1963c3f6afc929ab49eaeed951c723a481499e31e9
```

**File:** volo-vault/local_dependencies/switchboard_sui/on_demand/Move.mainnet.toml (L18-23)
```text
# New version:
# First Publish: 0xc3c7e6eb7202e9fb0389a2f7542b91cc40e4f7a33c02554fec11c4c92f938ea3
# Second Publish: 0xe6717fb7c9d44706bf8ce8a651e25c0a7902d32cb0ff40c0976251ce8ac25655
# AdminCap: 0xf02428df77e94f22df093b364d7e2b47cacb96a1856f49f5e1c4927705d50050
# State: 0x93d2a8222bb2006d16285ac858ec2ae5f644851917504b94debde8032664a791
# UpgradeCap: 0xe4b73392789cbda0420785a98eae24a4eef3a263317247c16fd1d192c1db2b93
```
